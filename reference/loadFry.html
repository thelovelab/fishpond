<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Load in data from alevin-fry USA mode — loadFry • fishpond</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Load in data from alevin-fry USA mode — loadFry"><meta property="og:description" content="Enables easy loading of sparse data matrices provided by
alevin-fry USA mode."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fishpond</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.1.36</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/swish.html">Swish: differential expression accounting for inferential uncertainty</a>
    </li>
    <li>
      <a href="../articles/allelic.html">SEESAW - Allelic expression analysis with Salmon and Swish</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/mikelove/fishpond/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Load in data from alevin-fry USA mode</h1>
    <small class="dont-index">Source: <a href="https://github.com/mikelove/fishpond/blob/HEAD/R/alevin-loadFry.R" class="external-link"><code>R/alevin-loadFry.R</code></a></small>
    <div class="hidden name"><code>loadFry.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Enables easy loading of sparse data matrices provided by
alevin-fry USA mode.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">loadFry</span><span class="op">(</span><span class="va">fryDir</span>, outputFormat <span class="op">=</span> <span class="st">"scRNA"</span>, nonzero <span class="op">=</span> <span class="cn">FALSE</span>, quiet <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>fryDir</dt>
<dd><p>path to the output directory returned by
alevin-fry quant command. This directory should contain a
<code>metainfo.json</code>, and an alevin folder which contains
<code>quants_mat.mtx</code>, <code>quants_mat_cols.txt</code> and
<code>quants_mat_rows.txt</code></p></dd>
<dt>outputFormat</dt>
<dd><p>can be <em>either</em> be a list that defines the
desired format of the output <code>SingleCellExperiment</code> object
<em>or</em> a string that represents one of the pre-defined output
formats, which are "scRNA", "snRNA", "scVelo" and "velocity".
See details for the explainations of the pre-defined formats and
how to define custom format.</p></dd>
<dt>nonzero</dt>
<dd><p>whether to filter cells with non-zero expression
value across all genes (default <code>FALSE</code>).
If <code>TRUE</code>, this will filter based on all assays.
If a string vector of assay names, it will filter based
on the matching assays in the vector.</p></dd>
<dt>quiet</dt>
<dd><p>logical whether to display no messages</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A <code>SingleCellExperiment</code> object that contains one
or more assays. Each assay consists of a gene by cell count matrix.
The row names are feature names, and the column names are cell
barcodes</p>
    </div>
    <div id="details-about-loadfry">
    <h2>Details about <code>loadFry</code></h2>
    

<p>This function consumes the result folder returned by running
alevin-fry quant in unspliced, spliced, ambiguous (USA) 
quantification mode, and returns a <code>SingleCellExperiement</code> object
that contains a final count for each gene within each cell. In
USA mode, alevin-fry quant returns a count matrix contains three
types of count for each feature (gene) within each sample (cell
or nucleus), which represent the spliced mRNA count of the gene (S),
the unspliced mRNA count of the gene (U), and the count of UMIs whose
splicing status is ambiguous for the gene (A). For each assay
defined by <code>outputFormat</code>, these three counts of a gene
within a cell will be summed to get the final count of the gene
according to the rule defined in the <code>outputFormat</code>.  The
returned object will contains the desired assays defined by
<code>outputFormat</code>, with rownames as the barcode of samples and
colnames as the feature names.</p>
    </div>
    <div id="details-about-the-output-format">
    <h2>Details about the output format</h2>
    

<p>The <code>outputFormat</code> argument takes <em>either</em> be a list that defines 
the desired format of the output 
<code>SingleCellExperiment</code> object <em>or</em> a string that represents one of 
the pre-defined output format.</p>
<p>Currently the pre-defined formats 
of the output <code>SingleCellExperiment</code> object are:</p><dl><dt>"scRNA":</dt>
<dd><p>This format is recommended for single cell experiments. 
It returns a <code>counts</code> assay that contains the S+A count of each gene in each cell.</p></dd>

<dt>"snRNA":</dt>
<dd><p>This format is recommended for single nucleus experiments. 
It returns a <code>counts</code> assay that contains the U+S+A count of each gene in each cell.</p></dd>

<dt>"raw":</dt>
<dd><p>This format put the three kinds of counts into three separate assays, 
which are <code>unspliced</code>, <code>spliced</code> and <code>ambiguous</code>.</p></dd>

<dt>"velocity":</dt>
<dd><p>This format contains two assays. 
The <code>spliced</code> assay contains the S+A count of each gene in each cell.
The <code>unspliced</code> assay contains the U counts of each gene in each cell.</p></dd>

<dt>"scVelo":</dt>
<dd><p>This format is for direct entry into velociraptor R package or 
other scVelo downstream analysis pipeline for velocity
analysis in R with Bioconductor. It adds the expected 
"S"-pliced assay and removes errors for size factors being
non-positive.</p></dd>


</dl><p>A custom output format can be defined using a list. Each element in the list 
defines an assay in the output <code>SingleCellExperiment</code> object. 
The name of an element in the list will be the name of the corresponding 
assay in the output object. Each element in the list should be defined as 
a vector that takes at least one of the three kinds of count, which are U, S and A.
See the provided toy example for defining a custom output format.</p>
    </div>
    <div id="details-about-load-fry-raw">
    <h2>Details about <code>load_fry_raw</code></h2>
    

<p>This function processes alevin-fry's quantification result
contained within the input folder.This function returns a list
that consists of the gene count matrix, the gene names list, the
barcode list, and some metadata, such as the number of genes in
the experiment and whether alevin-fry was executed in USA
mode. In the returned list, the all-in-one count matrix,
<code>count_mat</code>, returned from the USA mode of alevin-fry
consists of the spliced count of genes defined in
<code>gene.names</code> for all barcodes defined in <code>barcodes</code>,
followed by the unspliced count of genes in the same order for
all cells, then followed by the ambiguous count of genes in the
same order for all cells.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>alevin-fry publication:</p>
<p>He, D., Zakeri, M., Sarkar, H. et al. "Alevin-fry unlocks rapid, accurate and 
memory-frugal quantification of single-cell RNA-seq data."
Nature Methods 19, 316–322 (2022).
<a href="https://doi.org/10.1038/s41592-022-01408-3" class="external-link">https://doi.org/10.1038/s41592-022-01408-3</a></p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Dongze He, with contributions from Steve Lianoglou, Wes Wilson</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"></span>
<span class="r-in"><span class="co"># Get path for minimal example avelin-fry output dir</span></span>
<span class="r-in"><span class="va">testdat</span> <span class="op">&lt;-</span> <span class="fu">fishpond</span><span class="fu">:::</span><span class="fu">readExampleFryData</span><span class="op">(</span><span class="st">"fry-usa-basic"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># This is exactly how the velocity format defined internally.</span></span>
<span class="r-in"><span class="va">custom_velocity_format</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"spliced"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>,<span class="st">"A"</span><span class="op">)</span>, <span class="st">"unspliced"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"U"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Load alevin-fry gene quantification in velocity format</span></span>
<span class="r-in"><span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu">loadFry</span><span class="op">(</span>fryDir<span class="op">=</span><span class="va">testdat</span><span class="op">$</span><span class="va">parent_dir</span>, outputFormat<span class="op">=</span><span class="va">custom_velocity_format</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> locating quant file</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reading meta data</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> USA mode: TRUE</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Processing 4 genes and 4 barcodes</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using user-defined output assays</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Building the 'spliced' assay, which contains S A</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Building the 'unspliced' assay, which contains U</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Constructing output SingleCellExperiment object</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Done</span>
<span class="r-in"><span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assayNames</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "spliced"   "unspliced"</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Load the same data but use pre-defined, velociraptor R pckage desired format</span></span>
<span class="r-in"><span class="va">scvelo_format</span> <span class="op">&lt;-</span> <span class="st">"scVelo"</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">scev</span> <span class="op">&lt;-</span> <span class="fu">loadFry</span><span class="op">(</span>fryDir<span class="op">=</span><span class="va">testdat</span><span class="op">$</span><span class="va">parent_dir</span>, outputFormat<span class="op">=</span><span class="va">scvelo_format</span>, nonzero<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> locating quant file</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reading meta data</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> USA mode: TRUE</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Processing 4 genes and 4 barcodes</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using pre-defined output format: scvelo</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Building the 'counts' assay, which contains S A</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Building the 'spliced' assay, which contains S A</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Building the 'unspliced' assay, which contains U</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Constructing output SingleCellExperiment object</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Done</span>
<span class="r-in"><span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assayNames</a></span><span class="op">(</span><span class="va">scev</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "counts"    "spliced"   "unspliced"</span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://www.linkedin.com/in/aqzhu91" class="external-link">Anqi Zhu</a>, <a href="https://mikelove.github.io" class="external-link">Michael Love</a>, <a href="https://k3yavi.github.io" class="external-link">Avi Srivastava</a>, <a href="https://combine-lab.github.io" class="external-link">Rob Patro</a>, <a href="https://sph.unc.edu/adv_profile/joseph-g-ibrahim-phd" class="external-link">Joseph Ibrahim</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

